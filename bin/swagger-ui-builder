#!/usr/bin/env node
'use strict';

var program = require('commander');
var fs = require('fs');
var swaggerFileValue;
var targetDirValue;

program
    .arguments('<swaggerFile> <targetDir>')
    .option('-b, --bundle <bundleTo>', 'Create bundle and save it to bundleTo, default bundle file is bundled.json')
    .action(function(swaggerFile, targetDir) {
        swaggerFileValue = swaggerFile;
        targetDirValue = targetDir;
    })
    .parse(process.argv);

if (typeof targetDirValue === 'undefined') {
    console.error("<targetDir> is required. Syntax is swagger-watcher <swaggerFile> <targetDir>");
    process.exit(1);
}

if (typeof swaggerFileValue === 'undefined') {
    console.error("<swaggerFile> is required. Syntax is swagger-watcher <swaggerFile> <targetDir>");
    process.exit(1);
}

if (typeof program.bundle === 'undefined') {
    program.bundle = 'bundled.json';
}

if (program.bundle === swaggerFileValue) {
    console.error("<bundle> value cannot be same as <swaggerFile> value.");
    process.exit(1);
}

if (!fs.existsSync(targetDirValue)) {
    console.error(targetDirValue + " does not exist.");
    process.exit(1);
}

if (!fs.existsSync(swaggerFileValue)) {
    console.error(swaggerFileValue + " does not exist.");
    process.exit(1);
}

require("../index.js").build(
    swaggerFileValue, 
    targetDirValue, 
    program.bundle
);
